---
alwaysApply: false
---

# Quick Labeling 불변 규칙 (핵심요약)

## 목적
- QuickLabelingCard 회귀(미노출/오작동)를 방지한다.

## 불변 조건(절대)
- **노출**: `status='completed'` AND **문제 1개 이상**
- **미노출**:
  - `pending|processing` → AnalyzingCard
  - `failed` → 실패 UI(숨기지 말 것)
  - `labeled` → 이미 저장 완료(카드 미노출)

## 백엔드 상태 전이(절대)
- 생성: `processing`
- 저장 완료(Problems+Labels) 후: `completed`
- **금지**: `completed`인데 문제 0개
  - 0개면 `failed` + `failure_stage/failure_message` 기록
- **금지**: `labeled → completed` 되돌림
  - 완료 업데이트는 `eq('status','processing')` 가드 필수

## 실패 기록(필수)
- `sessions.failure_stage`, `sessions.failure_message`는 **빈 값 금지**

## 변경 후 스모크(필수)
- 업로드 후 60초 내 Stats 상단에 **QuickLabelingCard** 노출 확인
- DB에서 `completed & 문제0` 케이스가 없는지 확인
