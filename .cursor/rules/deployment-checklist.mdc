---
description: 배포 시 필수 체크리스트
---

# 배포 체크리스트 (핵심요약)

## 목적
- 배포 후 회귀(카드 미노출/데이터 공유/Edge Function 실패)를 **배포 전에 차단**한다.

## 배포 전: 필수 확인(5분)
- **데이터 격리**: 모든 조회에 `user_id` 필터링 또는 소유권 검증이 있는가
  - `fetchUserSessions()` → `.eq('user_id', userId)`
  - `fetchStatsByType()` → 조인 경로로 user_id 필터
  - `fetchSessionProblems()/deleteSession()` → 소유권 검증
  - `vw_stats_by_type` 직접 사용 금지
- **Edge Function**: 입력/환경변수 검증, 에러 처리, 단계 로그가 유지되는가
  - 입력: `imageBase64`, `userId` 필수
  - 환경변수: `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `GEMINI_API_KEY`

## 배포 절차(필수)
- **클라이언트**: Git push → Netlify 자동 배포
- **Edge Function**: Supabase CLI 금지, **MCP 배포 도구만 사용**
  - 배포 후 Supabase 대시보드에서 **ACTIVE/버전 증가** 확인
  - 로그에서 Step 흐름이 찍히는지 확인

## 배포 후: 최소 검증(10분)
- **기능 스모크**
  - 업로드 → 즉시 성공 메시지 → `/recent` 이동
  - 분석 중 `AnalyzingCard` 표시
  - 완료 후 `QuickLabelingCard` 표시
  - 저장 후 “최근 업로드한 문제”에 반영
- **보안 스모크(필수)**
  - 사용자 A 데이터 생성 → 사용자 B에서 A 데이터가 **절대 보이지 않음**
- **로그 스모크**
  - Edge Function 로그에서 실패 시 원인(`failure_stage/message`)이 남는지 확인

## 사고 대응(요약)
- **데이터 공유 의심**: 즉시 중단 → 원인 수정 → 재배포 → 다중 사용자 격리 재검증